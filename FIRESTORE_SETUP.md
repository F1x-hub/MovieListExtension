# Настройка правил Firestore

## Проблема
Приложение получает ошибку "Missing or insufficient permissions" при попытке кешировать фильмы в Firestore.

## Решение

### Шаг 1: Откройте Firebase Console
1. Перейдите на https://console.firebase.google.com/
2. Выберите проект `movielistdb-13208`

### Шаг 2: Настройте правила Firestore
1. В левом меню выберите **Firestore Database**
2. Перейдите на вкладку **Rules** (Правила)
3. Скопируйте содержимое файла `firestore.rules` из корня проекта
4. Вставьте правила в редактор
5. Нажмите **Publish** (Опубликовать)

### Шаг 3: Проверьте работу
После применения правил приложение сможет:
- ✅ Кешировать фильмы (все авторизованные пользователи)
- ✅ Читать кешированные фильмы (все пользователи)
- ✅ Создавать и обновлять рейтинги (авторизованные пользователи)
- ✅ Управлять своими профилями (только владельцы)

## Как работает кеширование

Приложение кеширует **только фильмы с рейтингами** в коллекции `movies`. Это позволяет:
- ✅ Сохранять данные только о важных фильмах (с оценками)
- ✅ Автоматически восстанавливать данные при загрузке рейтингов
- ✅ Не хранить лишние данные о непросмотренных фильмах

### Восстановление данных

Если коллекция `movies` пуста или была удалена, приложение автоматически:
1. Загружает рейтинги из коллекции `ratings`
2. Проверяет наличие данных о фильмах в кеше
3. **Автоматически загружает недостающие данные из Kinopoisk API**
4. Кеширует их для будущего использования

Это означает, что удаление коллекции `movies` не критично - данные восстановятся автоматически.

## Структура коллекций Firestore

```
firestore/
├── movies/              # Кеш фильмов
│   └── {movieId}
│       ├── kinopoiskId
│       ├── name
│       ├── posterUrl
│       ├── year
│       ├── genres
│       └── lastUpdated
│
├── ratings/             # Рейтинги фильмов
│   └── {ratingId}
│       ├── userId
│       ├── movieId
│       ├── rating
│       ├── comment
│       └── createdAt
│
└── users/               # Профили пользователей
    └── {userId}
        ├── displayName
        ├── email
        ├── photoURL
        └── createdAt
```
