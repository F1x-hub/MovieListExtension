<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collection - Movie Rating Extension</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="../../shared/styles/common.css">
    <link rel="stylesheet" href="../../shared/styles/theme.css">
    <link rel="stylesheet" href="../../shared/styles/components.css">
    <link rel="stylesheet" href="../../shared/styles/navigation.css">
    <link rel="stylesheet" href="../../shared/styles/router.css">
    <link rel="stylesheet" href="../../shared/styles/search.css">
    <link rel="stylesheet" href="../../shared/styles/movie-card.css">
    <link rel="stylesheet" href="../../shared/styles/collection.css">
    
    <!-- Firebase -->
    <script src="../../../libs/firebase-app-compat.js"></script>
    <script src="../../../libs/firebase-auth-compat.js"></script>
    <script src="../../../libs/firebase-firestore-compat.js"></script>
    
    <!-- Services -->
    <script src="../../shared/firestore.js"></script>
    <script src="../../shared/config/kinopoisk.config.js"></script>
    <script src="../../shared/services/RatingsCacheService.js"></script>
    <script src="../../shared/services/RatingService.js"></script>
    <script src="../../shared/services/MovieCacheService.js"></script>
    <script src="../../shared/services/KinopoiskService.js"></script>
    <script src="../../shared/services/UserService.js"></script>
    <script src="../../shared/services/WatchlistService.js"></script>
    <script src="../../shared/services/FavoriteService.js"></script>
    <script src="../../shared/services/CollectionService.js"></script>
    <script src="../../shared/utils/Utils.js"></script>
    <script src="../../shared/utils/IconUtils.js"></script>
    <script src="../../shared/utils/Icons.js"></script>
    
    <!-- Components -->
    <script src="../../shared/components/MovieCard.js"></script>
    <script src="../../shared/components/Navigation.js"></script>
    <script src="../../shared/components/Router.js"></script>
</head>
<body>
    <!-- Navigation will be inserted here by Navigation.js -->
    
    <!-- Main Content -->
    <main class="collection-main">
        <div class="collection-container">
            <!-- Page Header -->
            <div class="collection-header" id="collectionHeader">
                <div class="collection-header-content">
                    <div class="collection-icon-title">
                        <span class="collection-icon" id="collectionIcon">üé¨</span>
                        <h1 class="collection-title" id="collectionTitle">Loading...</h1>
                    </div>
                    <div class="collection-meta">
                        <span class="collection-count" id="collectionCount">0 —Ñ–∏–ª—å–º–æ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</span>
                    </div>
                    <div class="collection-actions">
                        <button class="collection-action-btn edit-btn" id="editCollectionBtn" title="Edit Collection">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px; vertical-align: middle;"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="collection-action-btn delete-btn" id="deleteCollectionBtn" title="Delete Collection">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px; vertical-align: middle;"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>

            <!-- Filters Section -->
            <div class="filters-section">
                <div class="filters-header">
                    <h3 class="filters-title">Filters & Search</h3>
                    <button class="clear-filters-btn" id="clearFiltersBtn">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></span>
                        Clear Filters
                    </button>
                </div>

                <div class="filters-grid">
                    <!-- Search -->
                    <div class="filter-group">
                        <label class="filter-label" id="searchLabel">Search in Collection</label>
                        <div class="search-input-wrapper">
                            <input type="text" class="search-input" id="collectionSearchInput" placeholder="–ü–æ–∏—Å–∫ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏...">
                            <span class="search-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></span>
                        </div>
                    </div>

                    <!-- Sort Options -->
                    <div class="filter-group">
                        <label class="filter-label">Sort By</label>
                        <div class="custom-dropdown" data-dropdown="sortFilter">
                            <button type="button" class="dropdown-trigger" id="sortFilterTrigger">
                                <span class="dropdown-value">Date Added (Newest)</span>
                                <span class="dropdown-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></span>
                            </button>
                            <div class="dropdown-list" id="sortFilterList">
                                <div class="dropdown-option" data-value="date-desc">Date Added (Newest)</div>
                                <div class="dropdown-option" data-value="date-asc">Date Added (Oldest)</div>
                                <div class="dropdown-option" data-value="title-asc">Title (A-Z)</div>
                                <div class="dropdown-option" data-value="title-desc">Title (Z-A)</div>
                                <div class="dropdown-option" data-value="rating-desc">My Rating (High to Low)</div>
                                <div class="dropdown-option" data-value="rating-asc">My Rating (Low to High)</div>
                                <div class="dropdown-option" data-value="year-desc">Year (Newest)</div>
                                <div class="dropdown-option" data-value="year-asc">Year (Oldest)</div>
                            </div>
                            <select class="filter-select-hidden" id="sortFilter">
                                <option value="date-desc">Date Added (Newest)</option>
                                <option value="date-asc">Date Added (Oldest)</option>
                                <option value="title-asc">Title (A-Z)</option>
                                <option value="title-desc">Title (Z-A)</option>
                                <option value="rating-desc">My Rating (High to Low)</option>
                                <option value="rating-asc">My Rating (Low to High)</option>
                                <option value="year-desc">Year (Newest)</option>
                                <option value="year-asc">Year (Oldest)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Info -->
            <div class="results-info" id="resultsInfo">
                <span class="results-count" id="resultsCount">Loading...</span>
            </div>

            <!-- Loading State -->
            <div class="loading-section" id="loadingSection">
                <div class="loading-spinner"></div>
                <p>Loading collection...</p>
            </div>

            <!-- Movies Grid -->
            <div class="movies-grid" id="moviesGrid">
                <!-- Movie cards will be inserted here -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-state-icon" id="emptyStateIcon">üé¨</div>
                <h3 class="empty-state-title">–í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è –ø—É—Å—Ç–∞</h3>
                <p class="empty-state-text" id="emptyStateText">–ù–∞—á–Ω–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–∏–ª—å–º—ã –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é</p>
                <button class="empty-state-btn" onclick="window.navigation?.navigateToPage('search')">
                    –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∏—Å–∫—É
                </button>
            </div>

            <!-- Error State -->
            <div class="error-state" id="errorState" style="display: none;">
                <div class="error-state-icon"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #ef4444;"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div>
                <h3 class="error-state-title">Something went wrong</h3>
                <p class="error-state-text" id="errorMessage">Failed to load collection</p>
                <button class="error-state-btn" id="retryBtn">Try Again</button>
            </div>
        </div>
    </main>

    <!-- Delete Confirmation Modal -->
    <div id="deleteCollectionModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–£–¥–∞–ª–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é?</h3>
                <button class="modal-close" id="deleteModalClose">√ó</button>
            </div>
            <div class="modal-body">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é "<span id="deleteCollectionName"></span>"?</p>
                <p style="color: #94a3b8; font-size: 14px; margin-top: 8px;">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –§–∏–ª—å–º—ã –Ω–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">–£–¥–∞–ª–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é</button>
            </div>
        </div>
    </div>

    <!-- Main Script -->
    <script src="collection.js"></script>
</body>
</html>
