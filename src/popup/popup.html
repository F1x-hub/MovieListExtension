<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Rating Extension</title>
    <link rel="stylesheet" href="../shared/styles/common.css">
    <link rel="stylesheet" href="../shared/styles/components.css">
    <link rel="stylesheet" href="../shared/styles/navigation.css">
    <link rel="stylesheet" href="../shared/styles/popup.css">
    <link rel="stylesheet" href="../shared/styles/overflow-fixes.css">
</head>
<body>
    <div class="popup-container">
        <!-- Header -->
        <header class="popup-header">
            <h1 class="popup-title">Movie Ratings</h1>
            <div class="auth-status" id="authStatus">
                <span class="status-indicator" id="statusIndicator"></span>
                <span id="statusText">Not authenticated</span>
            </div>
        </header>

        <!-- Initial Loading -->
        <div class="initial-loading" id="initialLoading" style="display: flex; justify-content: center; align-items: center; padding: 60px 20px;">
            <div class="loading-spinner"></div>
        </div>

        <!-- Auth Section -->
        <div class="auth-section" id="authSection" style="display: none;">
            <div class="auth-tabs">
                <button class="tab-btn active" data-tab="google">Google</button>
                <button class="tab-btn" data-tab="email">Email</button>
            </div>
            
            <div class="tab-content active" id="googleTab">
                <button id="loginBtn" class="btn btn-primary">Sign in with Google</button>
            </div>
            
            <div class="tab-content" id="emailTab">
                <div class="email-auth-forms">
                    <form id="loginForm" class="auth-form">
                        <h3>Sign In</h3>
                        <div class="form-group">
                            <input type="email" id="loginEmail" class="form-input" placeholder="Email" required>
                        </div>
                        <div class="form-group">
                            <input type="password" id="loginPassword" class="form-input" placeholder="Password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Sign In</button>
                    </form>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <form id="registerForm" class="auth-form">
                        <h3>Sign Up</h3>
                        <div class="form-group">
                            <input type="email" id="registerEmail" class="form-input" placeholder="Email" required>
                        </div>
                        <div class="form-group">
                            <input type="password" id="registerPassword" class="form-input" placeholder="Password (min 6 chars)" required minlength="6">
                        </div>
                        <button type="submit" class="btn btn-accent">Sign Up</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent" style="display: none;">
            <!-- User Actions -->
            <div class="user-actions">
                <div class="user-info">
                    <img id="userAvatar" class="user-avatar" src="" alt="User Avatar" style="display: none;">
                    <span id="userName">User</span>
                </div>
                <div class="feed-actions">
                    <button id="settingsBtn" class="btn btn-ghost btn-sm">Settings</button>
                    <button id="logoutBtn" class="btn btn-secondary btn-sm">Sign Out</button>
                </div>
            </div>
            
            <!-- Search Section -->
            <div class="search-section">
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search movies...">
                    <button id="searchIconBtn" class="search-icon">üîç</button>
                    <div id="searchResults" class="search-results" style="display: none;"></div>
                </div>
            </div>

            <!-- Feed Section -->
            <div class="feed-section">
                <div class="feed-header">
                    <h2 class="feed-title">Recent Ratings</h2>
                    <div class="feed-actions">
                        <button id="viewAllRatingsBtn" class="btn btn-primary btn-sm">View All Ratings</button>
                        <button id="refreshBtn" class="btn btn-ghost btn-sm">Refresh</button>
                    </div>
                </div>
                
                <div class="loading" id="loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <span>Loading...</span>
                </div>
                
                <div class="feed-content" id="feedContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">üé¨</div>
                        <h3 class="empty-state-title">No ratings yet</h3>
                        <p class="empty-state-text">Start rating movies to see them here!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage" style="display: none;"></div>
    </div>

    <!-- Scripts -->
    <script src="../../libs/firebase-app-compat.js"></script>
    <script src="../../libs/firebase-firestore-compat.js"></script>
    <script src="../../libs/firebase-auth-compat.js"></script>
    <script src="../shared/config/kinopoisk.config.js"></script>
    <script src="../shared/services/KinopoiskService.js"></script>
    <script src="../shared/services/MovieCacheService.js"></script>
    <script src="../shared/services/RatingService.js"></script>
    <script src="../shared/services/RatingsCacheService.js"></script>
    <script src="../shared/services/UserService.js"></script>
    <script src="../shared/utils/helpers.js"></script>
    <script src="../shared/utils/Utils.js"></script>
    <script src="../shared/components/Navigation.js"></script>
    <script src="../shared/firestore.js"></script>
    <script src="popup.js"></script>
</body>
</html>
